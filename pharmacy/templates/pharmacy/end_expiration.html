{% extends 'pharmacy/base.html' %}
{% load crispy_forms_tags %}
{% block content %}

<div class="container pt-5 pr-5">



 <div class="fw-bold fs-3 pb-3">
الأدوية المنتهي صلاحيتها
            </div>


{% if medicines %}

    <table class="table">
        <thead class="table-dark">

        <th scope="col">الدواء</th>
        <th scope="col">الفئة</th>
        <th scope="col">السعر</th>
        <th scope="col">الكمية</th>
        <th scope="col">ملاحظات</th>
        <th scope="col">بداية الصلاحية</th>
        <th scope="col">نهاية الصلاحية</th>
        <th scope="col">تعديل</th>
        <th scope="col">حذف</th>
        </thead>
        <tbody>

        {% for med in medicines %}
        <tr>


            <td>
                <div class="fw-bold fs-4">{{med.name}}</div>
            </td>
            <td>
                <div class="fw-bold fs-4">{{med.category}}</div>
            </td>
            <td>
                <div class="fw-bold fs-4">{{med.price}}</div>
            </td>


            <td>
                <div class="fw-bold fs-4">{{med.quantity}}</div>
            </td>
            <td>

                <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    <i class="fas fa-notes-medical fa-sm"></i>
                </button>


                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
                     tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="staticBackdropLabel">ملاحظات</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                {{med.notes}}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">إغلاق
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


            </td>
            <td>
                <div class="fw-bold fs-4">{{med.start_date}}</div>
            </td>
            <td>
                <div class="fw-bold fs-4">{{med.end_date}}</div>
            </td>


            <td>
                <a href="http://127.0.0.1:8000/pharmacy/{{profile_user.username}}/medicine/update_medicine/{{med.id}}/"
                   type="button" class="btn btn-dark">
                    <i class="far fa-edit fa-sm"></i>
                </a>
            </td>


            <td>


                <!-- Button trigger modal -->
                <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    <i class="fas fa-eraser fa-sm"></i>
                </button>

                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">حذف</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                هل أنت متأكد من حذف الدواء من قاعدة البيانات ؟
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">لا</button>
                                <a href="http://127.0.0.1:8000/pharmacy/{{profile_user.username}}/medicine/delete_medicine/{{med.id}}/"
                                   type="button" class="btn btn-danger">نعم (حذف)</a>
                            </div>
                        </div>
                    </div>
                </div>


            </td>
        </tr>

        {% endfor %}

        </tbody>
    </table>



    {% endif %}





    <form class="card card-sm">
        <div class="card-body row no-gytters align-items-center">
            <div class="col">
                <input type="search" name="item_name" placeholder="ابحث باسم الدواء"
                       class="form-control form-control-borderless" id="tags">
                <script>
                    $(function () {
                        var availableTags = [
                            {% for med in medicine_all %}"{{med.name}}", {% endfor %}
                                ];
                    $("#tags").autocomplete({
                        source: availableTags,
                        select: function (event, ui) {
                            $("#tags").val(ui.item.label);
                            $("#tags").val(ui.item.value);
                            this.form.submit();
                        }
                    });

                            } );
                </script>
            </div>

        </div>
    </form>


    <table class="table">
        <thead class="table-dark">
        <th scope="col">#</th>
        <th scope="col">الدواء</th>
        <th scope="col">الفئة</th>
        <th scope="col">السعر</th>
        <th scope="col">الكمية</th>
        <th scope="col">بداية الصلاحية</th>
        <th scope="col">نهاية الصلاحية</th>
        <th scope="col">تعديل</th>
        </thead>
        <tbody>

        {% for short in shorts %}
        <tr>
            <th scope="row">{{ forloop.counter }}</th>
            <td>
                <div id="nm{{short.id}}">{{short.name}}</div>
            </td>
            <td>{{short.category}}</td>
            <td>
                <div id="price{{short.id}}">{{short.price}}</div>
            </td>
            <td>{{short.quantity}}</td>
            <td>{{short.start_date}}</td>
            <td>{{short.end_date}}</td>
            <td>
                <a href="http://127.0.0.1:8000/pharmacy/{{profile_user.username}}/medicine/update_medicine/{{short.id}}/"
                   type="button" class="btn btn-dark btn-sm">
                    <i class="far fa-edit fa-sm"></i>
                </a>
            </td>

        </tr>

        {% endfor %}

        </tbody>
    </table>


</div>

<div class="container pt-2 pb-3 text-right">

    <nav aria-label="...">
        <ul class="pagination">

            <li class="page-item">
                {% if medicine.has_previous %}
                <a class="page-link" href="?page={{medicine.previous_page_number}}" tabindex="-1" aria-disabled="true">الصفحة
                    السابقة</a>
                {% else %}
                <a class="page-link disabled" tabindex="-1" aria-disabled="true">الصفحة السابقة</a>
                {% endif %}
            </li>


            {% for n in medicine.paginator.page_range %}
            {% if medicine.number == n %}
            <li class="page-item active">
                <span class="page-link">{{ n }}<span class="sr-only">(current)</span></span>
            </li>
            {% elif n > medicine.number|add:'-3' and n < medicine.number|add:'3' %}
            <li class="page-item"><a class="page-link" href="?page={{ n }}">{{ n }}</a></li>
            {% endif %}
            {% endfor %}


            <li class="page-item">
                {% if medicine.has_next %}
                <a class="page-link" href="?page={{medicine.next_page_number}}">الصفحة التالية</a>
                {% else %}
                <a class="page-link disabled" href="#">الصفحة التالية</a>
                {% endif %}
            </li>


        </ul>
    </nav>

</div>



{% endblock %}